---
layout: post
title: "A Story About Visualization"
tags: stories visualization stratigraphy
---

When I first started at the Energy MegaCorp where I currently work, I was hired into an inter-disciplinary team of computational scientists and geoscientists. It was a grand experiment in bringing together people from very different disciplines (and mindsets). Many of today's hydrocarbon reservoirs were formed when rivers transported vast quantities of suspended sediment and organic matter, depositing them in layers (Greek: _strata_) on the sea floor. If we could model these flows, perhaps we could predict something useful about the probability of finding hydrocarbons - the ultimate prize in geological exploration. This was the objective of the Process Stratigraphy team.

The computational scientists began implementing a simplified model of sediment-laden turbulent flows that had been proposed 20 years ago[^parker-1986], while the geoscientists observed with great interest and healthy skepticism. Five years and $40 million later, the computational scientists declared victory[^halsey-2017]. Everyone had gathered in a conference room to witness what was certainly going to be a visual treat - a high-resolution four-dimensional motion-picture of the currents flowing over the sea floor, creating beautiful bathymetry with hues indicating exactly where the hydrocarbons had been deposited 100 million years ago. What they saw instead was a two-dimensional rectangular mesh on which highly pixelated colors moved so rapidly that it was hardly possible to comprehend what any of it meant. But here's the thing about geoscientists - they are an incredibly graceful and an incredibly optimistic bunch. And so, they celebrated, accepting the computational scientists' claim that the forward model accurately captured the physics of these pre-historic flows.

[^parker-1986]: Parker, G., Fukushima, Y., & Pantin, H. M. (1986). Self-accelerating turbidity currents. Journal of Fluid Mechanics, 171, 145-181.

[^halsey-2017]: Halsey, T. C., Kumar, A., & Perillo, M. M. (2017). Sedimentological regimes for turbidity currents: Depth‚Äêaveraged theory. Journal of Geophysical Research: Oceans, 122(7), 5260-5285.

In order to be useful for locating hydrocarbons or predicting the probability of finding them, the forward model needed to be inverted. The inputs to the forward model included the conditions upstream of the flow such as the speed at which it entered the sea floor, and the distribution of particle sizes in the suspension. These were unknown, of course, and needed to be determined by matching the output of the forward model with any present-day observations that were available, including seismic data and drilled core samples. That's where I came in.

Having oriented myself with all this history, I set about the task of inverting the forward model. But the pixelated colors on the rectangular mesh didn't capture my imagination. I needed to see what the forward model behaved like and inspect it in much greater resolution. Thus began my foray into the art of visualization. I commissioned thousands of CPUs to run the forward model on an embarrassingly large grid for several days. I discovered [MayaVi](https://docs.enthought.com/mayavi/mayavi/), a Python-based visualization library that sat two levels of abstraction above [OpenGL](https://www.opengl.org/) and offered an easy way to render 3D bathymetry with a ridiculous amount of control on lighting and camera positioning. I started generating thousands of frames as the simulations ran, stitching them together to create movies with frame rates of 30-60 fps. I was having so much fun that I forgot all about inversion. But as it would turn out, my visualizations played a crucial role in the outcome of that effort as well.

Back to the conference room. Although I had briefly experienced it before with my Ph.D. adviser, this time it was different because there were _4_ geoscientists in the room, including one not-so-excitable seasoned campaigner in his early 60s. There is nothing - _nothing_ - like watching someone like that jumping off their seats and stopping just short of cursing with excitement at what they were seeing. This - the high-resolution four-dimensional motion-picture of the simulated evolution of the sea floor from 100 million years ago - was the pipe-dream-come-true of the Process Stratigraphy experiment. My visualizations showed how the deepwater currents carved out a channel, then how the channels bifurcated, avulsed and formed beautiful sand-filled lobes topped with a layer of mud as the channel retreated and avulsed again upstream. All of which made total sense to the geoscientists whose entire art was about recreating precisely this story in their heads by traveling to (often exotic) locations around the world and looking at outcrops. It was a win for computational science. And no one would ever know that the SHA-256 of the code that produced the pixelated rectangular animation and what the geoscientists were seeing now was identical.

I began to acquire a certain notoriety, going from being known as the inversion guy to the guy that makes the movies (and perhaps doesn't really know math?). [Imposter syndrome](https://en.wikipedia.org/wiki/Impostor_syndrome) was kicking in. As critical as it seemed for the geoscientists to be able to better inspect (visually) the behavior of the forward model, and as aligned with that goal my efforts appeared to be, there were lingering doubts about my ability to invert the forward model. Murmurs began to float (admittedly some were voices inside my head) that perhaps I was copping out of the hard stuff. But something interesting happened just then. I had run a simulation with perfectly symmetrical initial conditions - a channel centered at the inlet of a square grid with a planar initial bathymetry. I had let it run with continuous flow for about 2 days, capturing a frame every 6 minutes. One of the geoscientists was interested in slowing down the movie near an event which showed a channel avulsing. I didn't have a good frame rate to do this, so I re-ran the simulation, this time capturing a frame every 2 minutes. I generated another movie and called the geoscientist over to my desk.

It was like one of those horror movies where they show a ghost appearing in a certain room and CCTV footage shows an empty room. No avulsion appeared in the slowed-down version. I repeated both runs, checking to ensure I was using exactly the same input - saving a frame every 2 minutes in one of the runs, and saving a frame every 6 minutes in the other. I showed them side-by-side and we watched an interesting phenomenon unfold. Both movies appeared to be identical - for a period of time. As the channels bifurcated and avulsed, the movies began to show divergent behavior - we were seeing a manifestation of the well-known [butterfly effect](https://en.wikipedia.org/wiki/Butterfly_effect) (the butterfly here being roundoff errors from floating-point arithmetic). Here was experimental evidence that the forward model was chaotic - something that wasn't easily observable if not for the high-resolution rendering in my visualizations. Also something that would have taken years of work with incredibly complicated math to prove on paper. It did not entirely surprise the geoscientists. But it meant something significant in terms of the forward model's predictability and invertibility[^hoyal-2018]. I began to run hundreds of simulations with slightly different inputs, reducing the difference between them to smaller and smaller values to observe how correlated the outputs were. I then did the opposite - running ensembles of simulations by [lattice hypercube sampling](https://en.wikipedia.org/wiki/Latin_hypercube_sampling) the entire range of inputs[^wahab-2018].

Unbeknownst to me, my analyses had created a ripple effect in the political landscape surrounding the project and set in motion a series of events that would alter the way the project was being marketed to upper management. I explained to a committee of senior technical advisers across disciplines including Reservoir Engineering, Optimization, Geophysics and Geoscience why it wasn't practical to invert the forward model. In my presentation, I included a suggestion as to how the forward model _could_ be used - in a statistical framework to make large-scale predictions about the behavior of turbidite fans. The inversion effort was subsequently abandoned. Today, the forward model is being used to generate physically plausible scenarios to assist geological modeling.

[^hoyal-2018]: Hoyal, D. C. J. D., Vishnampet, R., Sun, H., & Shringarpure, M. (2018, December). Prediction under chaos: The (f) utility of physics-based modeling of deepwater stratigraphy. In AGU Fall Meeting Abstracts (Vol. 2018, pp. OS13C-1498).

[^wahab-2018]: Wahab, A., Hoyal, D. C., Sun, H., Vishnampet, R., Shringarpure, M., Prasad, B., & Straub, K. M. (2018, December). Development of Statistical Metrics to Understand Stratigraphic Architecture in Deep-Water Fan Deposits. In AGU Fall Meeting Abstracts (Vol. 2018, pp. EP53D-1887).